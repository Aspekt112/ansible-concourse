---
# https://github.com/cloudfoundry-incubator/garden-linux/blob/master/README.md
# https://github.com/concourse/concourse/issues/229
# https://github.com/concourse/bin

- name: Check for python2.7
  hosts: all
  gather_facts: False
  become: True
  tasks:
    - name: install python 2
      raw: test -e /usr/bin/python || (apt -y update && apt install -y python-minimal)
      changed_when: False


- name: Provision my keys
  hosts: all
  become: True
  vars:
    CONCOURSE_WEB_EXTERNAL_URL        : "http://192.168.50.150:8080"
    CONCOURSE_WORKER_BIND_IP          : "0.0.0.0"
    CONCOURSE_WEB_BASIC_AUTH_USERNAME : "myuser"
    CONCOURSE_WEB_BASIC_AUTH_PASSWORD : "mypass"
    concourseci_reboot                : false
  roles:
    - { name: hosts,               tags: "hosts" }
    - { name: "postgresql",        tags: "concourse" }
    - { name: "ansible-concourse", tags: "concourse" }

- name: Install packages required for testing
  hosts: all
  gather_facts: False
  become: True
  tasks:
    - name: install net-tools
      apt:
       name=net-tools
      when: "{{ ansible_os_family == 'Debian' }}"